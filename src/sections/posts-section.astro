---
import SectionTitle from "@/components/section-title.astro";
import SectionWrapper from "@/components/section-wrapper.astro";
import PostsIcon from "@/icons/posts-icon.astro";
import PostCard from "@/components/post-card.astro";

import { getCollection } from "astro:content";

const posts = await getCollection("posts");
---

<script>
  import { animate } from "motion";

  const section = document.querySelectorAll(".projects-section");
  const storage = window.localStorage;
  const currTimestamp = Date.now();
  const timestamp = JSON.parse(storage.getItem("timestamp") || "1000");

  const timeLimit = 60 * 60 * 1000; // 1 hour

  const hasTimePassed = currTimestamp - timestamp > timeLimit;

  if (hasTimePassed) {
    animate(section, { opacity: [0, 1] }, { delay: 2, duration: 0.8 });
  }
</script>

<SectionWrapper className="projects-section">
  <SectionTitle>
    <PostsIcon className="size-8 stroke-[2.5px]" />
    Posts
  </SectionTitle>

  {
    posts.map((post) => {
      const { data, slug } = post;
      const { title, description, date } = data;

      return (
        <PostCard
          title={title}
          description={description}
          date={date}
          slug={slug}
        />
      );
    })
  }
</SectionWrapper>
